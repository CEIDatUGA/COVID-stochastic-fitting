plotscenarios <- function(mif_res, scenario_res)
{
  
  # Take the data generated by the scenario simulations and bring them in a form 
  # that can easily be used by the shiny app
  #final result for shiny app should be a large data frame with these columns: 
  #Location(State), Data Source, Scenario, Pop_Size (for per 100K plots)
  #Variable name (Daily Cases, Weekly Deaths, etc.), Variable type (e.g. ci5, ci95, mean), value
  #will likely not do multiple data sources or per 100K plots for initial iteration
  
  library('dplyr')
  library('here')
  library('purrr')
  
  #load data for US population size per state so we have all state names and their population sizes
  us_popsize <- readRDS(here("data","us_popsize.rds")) %>% rename(state_abr = state, state = state_full)
  statenames = us_popsize$state
  
  # loop over all states
  for (state_now in statenames)
  {
    #find all simulation scenario files for current state
    #make regex pattern
    filepattern = paste0("\\b",state_now, ".*simulation-scenarios.rds")
    files = list.files(here('output'),pattern = filepattern, full.names = TRUE) #find all files for this state
    newest_ind = which.max(file.mtime(files)) #find most recent file based on time stamp
    scenario_res <- readRDS(files[newest_ind]) #load most recent file for this state
  
  
  
  # combining all simulations for all scenarios into a large data frame
  # scenario will be a column, 
  for (n in 1:length(scenario_res))  #loop over each scenario
  {
    x = scenario_res[[n]]
    state_arr = x$states
    dims = dim(state_arr)
    
    #reformat 3d array of form Nobs/Nstates  X nsim  X times 
    df = t(array(state_arr, dim = c(dims[1]*dims[2],dims[3])))
    df$Dates = 
    
    #CONTINUE HERE
      
    df <- df %>%       
       
         group_by(Date, Variable) %>%       #compute summary stats (ci10, ci90, mean)
         summarise(ci10 = ceiling(quantile(Value, 0.1)),
                   mean_val = ceiling(mean(Value)),
                   ci90 = ceiling(quantile(Value, 0.9))) %>%
         
  }  
} #end main function